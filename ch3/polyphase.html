

<!DOCTYPE html>


<html >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>3.4. Polyphase Filtering &#8212; Digital Communications with SDRs</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'ch3/polyphase';</script>
    <link rel="shortcut icon" href="../_static/logo.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3.5. References and further reading" href="filter_exs.html" />
    <link rel="prev" title="3.3. Multi-rate Filtering" href="multirate.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Digital Communications with Software Defined Radios
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../ch1/introduction.html">1. Introduction</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch2/prelims.html">2. Some Programming Prelims</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch2/uhd.html">2.1. UHD</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch2/multithread.html">2.2. Elementary Multi-threading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch2/prelims_exs.html">2.3. References and further reading</a></li>

</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="filter.html">3. Multi-rate Filtering</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="fftw3.html">3.1. FFTW3 Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="overlapsave.html">3.2. Overlap Save Algorithm</a></li>
<li class="toctree-l2"><a class="reference internal" href="multirate.html">3.3. Multi-rate Filtering</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">3.4. Polyphase Filtering</a></li>
<li class="toctree-l2"><a class="reference internal" href="filter_exs.html">3.5. References and further reading</a></li>

</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ch4/part15.html">4. Digest of FCC Regulations Part 15</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch5/usrp.html">5. USRP Tuning and Calibration</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch5/tuning.html">5.1. Frequency Tuning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch5/iq.html">5.2. DC Offset and IQ Imbalance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch5/usrp_refs.html">5.3. References and further reading</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch6/signal.html">6. Signal Generation and Capture</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch6/generate.html">6.1. TX Pulse Shaping</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch6/capture.html">6.2. RX Signal Capture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch6/signal_refs.html">6.3. References and further reading</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch7/sync.html">7. Signal Acquisition and Synchronization</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch7/dll.html">7.1. Closed-Loop Symbol Synchronization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch7/acq.html">7.2. Signal Acquisition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch7/signature.html">7.3. Signature Signal Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch7/mseq.html">7.4. Maximal-length Sequences</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch7/zc.html">7.5. Zadoff–Chu Sequences</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch7/sync_refs.html">7.6. References and further reading</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch8/noncoh.html">8. Non-coherent Demodulation</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch8/mlnoncoh.html">8.1. Maximum Likelihood Non-coherent Demodulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch8/ask.html">8.2. <span class="math notranslate nohighlight">\(M\)</span>-ary Amplitude Shift Keying (<span class="math notranslate nohighlight">\(M\)</span>-ASK)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch8/dpsk.html">8.3. <span class="math notranslate nohighlight">\(M\)</span>-ary Differential Phase Shift Keying (<span class="math notranslate nohighlight">\(M\)</span>-DPSK)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch8/noncoh_usrp.html">8.4. USRP Implementation</a></li>

</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch9/carrier.html">9. Carrier Synchronization</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch9/mlest.html">9.1. Basic Model</a></li>

<li class="toctree-l2"><a class="reference internal" href="../ch9/dd_pll.html">9.3. Decision-directed Phase-locked Loop</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch9/ndd_pll.html">9.4. Non-decision-directed Phase-locked Loop</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch9/carrier_refs.html">9.5. References and further reading</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ch10/coh.html">10. Coherent Demodulation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch11/arq.html">11. Automatic Repeat Request</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch11/crc.html">11.1. Cyclic Redundancy Check Codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch11/protocols.html">11.2. Simple ARQ Protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch11/duplex.html">11.3. Duplex Transmission using USRPs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch11/arq_exs.html">11.4. References and further reading</a></li>

</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/tanfwong/sdr_notes" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/tanfwong/sdr_notes/issues/new?title=Issue%20on%20page%20%2Fch3/polyphase.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/ch3/polyphase.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Polyphase Filtering</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#polyphase-structure">3.4.1. Polyphase structure</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#time-domain-polyphase-implementation">3.4.2. Time-domain polyphase implementation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#frequency-domain-polyphase-implementation">3.4.3. Frequency-domain polyphase implementation</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="polyphase-filtering">
<span id="sec-polyphase"></span><h1><span class="section-number">3.4. </span>Polyphase Filtering<a class="headerlink" href="#polyphase-filtering" title="Permalink to this headline">#</a></h1>
<ul class="simple">
<li><p><em>For discussion simplicity and in any practical implementation, we
assume below <span class="math notranslate nohighlight">\(U\)</span> and <span class="math notranslate nohighlight">\(D\)</span> are relative primes</em>, although the
algorithm described below works even when <span class="math notranslate nohighlight">\(U\)</span> and <span class="math notranslate nohighlight">\(D\)</span> are not.</p></li>
</ul>
<section id="polyphase-structure">
<h2><span class="section-number">3.4.1. </span>Polyphase structure<a class="headerlink" href="#polyphase-structure" title="Permalink to this headline">#</a></h2>
<ul>
<li><p>As shown in <span id="id1">[<a class="reference internal" href="filter_exs.html#id8" title="A. V. Oppenheim and R. W. Shafer. Discrete-time Signal Processing. Prentice Hall, 3rd. edition, 2010. ISBN 978-0-13-198842-2.">1</a>]</span> Section 4.7.4, the multi-rate
filter in <a class="reference internal" href="multirate.html#sec-multirate"><span class="std std-numref">Section 3.3</span></a> is equivalent to the
<strong>polyphase</strong> structure below:</p>
<a class="reference internal image-reference" href="../_images/polyphase.jpg"><img alt="Polyphase implementation of multi-rate filter" class="align-center" src="../_images/polyphase.jpg" style="width: 800px;" /></a>
<p>where, for <span class="math notranslate nohighlight">\(p=0,1, \ldots, U-1\)</span>, the impulse response <span class="math notranslate nohighlight">\(e_p[n]\)</span> of
the filter <span class="math notranslate nohighlight">\(E_p(z)\)</span> (which runs at the same rate as <span class="math notranslate nohighlight">\(x[n]\)</span>) is
given by <span class="math notranslate nohighlight">\(e_p[n] = h[Un+p]\)</span>, where <span class="math notranslate nohighlight">\(h[n]\)</span> is the impulse response fo
the filter in the up-sampled domain and its length is <span class="math notranslate nohighlight">\(L\)</span> as
discussed in <a class="reference internal" href="multirate.html#sec-multirate"><span class="std std-numref">Section 3.3</span></a>.</p>
</li>
<li><p>It is also quite easy to see that the above polyphase structure can
be redrawn in the following form, which is more conducive to
implementation:</p>
<a class="reference internal image-reference" href="../_images/polyphase_imp.jpg"><img alt="Impoved polyphase implementation of multi-rate filter" class="align-center" src="../_images/polyphase_imp.jpg" style="width: 800px;" /></a>
<p>where <span class="math notranslate nohighlight">\(\%\)</span> is the remainder operator. Note that the circular switch
(MUX) runs in the counter-clockwise direction at <span class="math notranslate nohighlight">\(U\)</span> times the
rate of the down-samplers.</p>
</li>
<li><p>Again, as shown in <span id="id2">[<a class="reference internal" href="filter_exs.html#id8" title="A. V. Oppenheim and R. W. Shafer. Discrete-time Signal Processing. Prentice Hall, 3rd. edition, 2010. ISBN 978-0-13-198842-2.">1</a>]</span> Section 4.7.4, the <span class="math notranslate nohighlight">\(p\)</span>th
branch above involving polyphase filter <span class="math notranslate nohighlight">\(z^{\left\lfloor
\frac{pD}{U} \right\rfloor} E_{pD\%U}(z)\)</span> can itself be
equivalent to the following polyphase structure:</p>
<a class="reference internal image-reference" href="../_images/polyphase_branch.jpg"><img alt="Polyphase implementation of a branch" class="align-center" src="../_images/polyphase_branch.jpg" style="width: 800px;" /></a>
<p>where, for <span class="math notranslate nohighlight">\(q=0,1, \ldots, D-1\)</span>, the impulse response
<span class="math notranslate nohighlight">\(f_{p,q}[n]\)</span> of the filter <span class="math notranslate nohighlight">\(F_{p,q}(z)\)</span> (which runs at <span class="math notranslate nohighlight">\(\frac{1}{D}\)</span> times
the rate of <span class="math notranslate nohighlight">\(x[n]\)</span>) is given by</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
  f_{p,q}[n] 
  &amp;= e_{pD\%U} \left[Dn+q+\left\lfloor \frac{pD}{U} \right\rfloor \right]  \\
  &amp; = h\left[ UDn + Uq + U \left\lfloor \frac{pD}{U} \right\rfloor + pD\%U \right] \\
  &amp; = h[UDn+Dp+Uq].
  \end{align*}\]</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Note that some of impulse responses <span class="math notranslate nohighlight">\(f_{p,q}[n]\)</span>’s may be
non-causal.</p>
</div>
<p>Also, it is easy to check that the length of each <span class="math notranslate nohighlight">\(f_{p,q}[n]\)</span> is at
most <span class="math notranslate nohighlight">\(\left\lceil \frac{L}{UD} \right\rceil+1\)</span></p>
</li>
<li><p>Putting the polyphase implementations of all branches back to the
second polyphase structure, we obtain the following overall
polyphase implementation of the multi-rate filter:</p>
<a class="reference internal image-reference" href="../_images/polyphase_overall.jpg"><img alt="Overall polyphase implementation of multi-rate filter" class="align-center" src="../_images/polyphase_overall.jpg" style="width: 1200px;" /></a>
<p>where the circular DEMUX runs in the clockwise direction at the rate
of <span class="math notranslate nohighlight">\(x[n]\)</span> and the circular MUX runs in the counter-clockwise direction
at <span class="math notranslate nohighlight">\(U\)</span> times the rate of the polyphase filter outputs.</p>
</li>
</ul>
</section>
<section id="time-domain-polyphase-implementation">
<h2><span class="section-number">3.4.2. </span>Time-domain polyphase implementation<a class="headerlink" href="#time-domain-polyphase-implementation" title="Permalink to this headline">#</a></h2>
<ul>
<li><p>Clearly, the polyphase structure is more suitable for parallel
implementation. In addition, we can also get computational
complexity advantage using the polyphase structure. Let’s start by
considering the computational complexity when each filter in the
polyphase structure above is implemented by doing direct time-domain
(linear) convolution.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\(N\)</span> and <span class="math notranslate nohighlight">\(L\)</span> denote the lengths of <span class="math notranslate nohighlight">\(x[n]\)</span> and <span class="math notranslate nohighlight">\(h[n]\)</span>,
respectively.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Be careful that <span class="math notranslate nohighlight">\(x[n]\)</span> and <span class="math notranslate nohighlight">\(h[n]\)</span> have different rates. The rate of
<span class="math notranslate nohighlight">\(h[n]\)</span> is <span class="math notranslate nohighlight">\(U\)</span> times that of <span class="math notranslate nohighlight">\(x[n]\)</span> because of up-sampling.</p>
</div>
<p>As before, we will assume <span class="math notranslate nohighlight">\(NU \gg L \gg UD\)</span>.</p>
</li>
<li><p>We have already worked out in <a class="reference internal" href="multirate.html#sec-multirate"><span class="std std-numref">Section 3.3</span></a> that the
number of multiplications needed per input sample in the direct
multi-rate time-domain implementation is
<span class="math notranslate nohighlight">\(\mathcal{O}\left(\frac{UL}{D} \right)\)</span>.</p></li>
<li><p>For the time-domain polyphase implementation, the length of each
polyphase filter <span class="math notranslate nohighlight">\(F_{p,q}(z)\)</span> is
<span class="math notranslate nohighlight">\(\mathcal{O}\left(\frac{L}{UD}\right)\)</span>. Since the length of the
input to each such filter is <span class="math notranslate nohighlight">\(\mathcal{O}\left(\frac{N}{D} \right)\)</span>,
the length of the output from each such filter is
<span class="math notranslate nohighlight">\(\mathcal{O}\left(\frac{N}{D}\right)\)</span>. To calculate each such output
sample, we need to do <span class="math notranslate nohighlight">\(\mathcal{O}\left(\frac{L}{UD}\right)\)</span>
multiplications. Remember that there are <span class="math notranslate nohighlight">\(UD\)</span> such polyphase
filters.  Hence, the total number of multiplications needed to
compute the whole <span class="math notranslate nohighlight">\(y[n]\)</span> is <span class="math notranslate nohighlight">\(\mathcal{O}\left(\frac{NL}{D}\right)\)</span>,
and hence the number of multiplications needed per input sample is
<span class="math notranslate nohighlight">\(\mathcal{O}\left(\frac{L}{D}\right)\)</span>.</p></li>
<li><p>In summary, the time-domain polyphase implementation saves by a
factor of <span class="math notranslate nohighlight">\(U\)</span> in computational complexity, compared with the direct
time-domain multi-rate implementation.</p></li>
</ul>
</section>
<section id="frequency-domain-polyphase-implementation">
<h2><span class="section-number">3.4.3. </span>Frequency-domain polyphase implementation<a class="headerlink" href="#frequency-domain-polyphase-implementation" title="Permalink to this headline">#</a></h2>
<ul>
<li><p>Frequency-domain polyphase filtering is a bit trickier. Consider a
frequency-domain implementation of the overall polyphase structure
shown above, based on the overlap-save algorithm. As discussed in
<a class="reference internal" href="overlapsave.html#sec-osa"><span class="std std-numref">Section 3.2</span></a>, we divide the batch of samples of the input signal
<span class="math notranslate nohighlight">\(x[n]\)</span> into overlapping blocks of length <span class="math notranslate nohighlight">\(D\, 2^m\)</span>, where <span class="math notranslate nohighlight">\(2^m\)</span> is
the FFT size. Similar to <a class="reference internal" href="overlapsave.html#sec-osa"><span class="std std-numref">Section 3.2</span></a>, the last <span class="math notranslate nohighlight">\(DM\)</span> output
samples of the inverse FFT give valid linear convolution results
that we will “save” for each block. Also as before, the amount of
overlap between adjacent input blocks is then <span class="math notranslate nohighlight">\(D(2^m-M)\)</span>. The
choices of <span class="math notranslate nohighlight">\(m\)</span> and <span class="math notranslate nohighlight">\(M\)</span> will be determined later.</p></li>
<li><p>Now, consider a block of <span class="math notranslate nohighlight">\(D\,2^m\)</span> samples of the input signal
<span class="math notranslate nohighlight">\(x[n]\)</span>. We may obtain the multi-rate filtered samples of the
output signal <span class="math notranslate nohighlight">\(y[n]\)</span> for this block by implementing the following steps:</p>
<ol class="arabic">
<li><p>Demultiplex (<span class="math notranslate nohighlight">\(\downarrow\! D\)</span>) <span class="math notranslate nohighlight">\(x[n] \)</span> into <span class="math notranslate nohighlight">\(x_q[n] = x[nD-q]\)</span> for <span class="math notranslate nohighlight">\(q=0,1,\ldots,D-1\)</span>.</p></li>
<li><p>For <span class="math notranslate nohighlight">\(q=0,1,\ldots,D-1\)</span>, calculate the <span class="math notranslate nohighlight">\(2^m\)</span>-point FFT <span class="math notranslate nohighlight">\(X_k^{(q)}\)</span> of <span class="math notranslate nohighlight">\(x_q[n]\)</span>.</p></li>
<li><p>For <span class="math notranslate nohighlight">\(p=0,1,\ldots,U-1\)</span>, calculate</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
      Y_k^{(p)} = \sum_{q=0}^{D-1} F_k^{(p,q)} X_k^{(q)}
      \end{equation*}\]</div>
<p>where <span class="math notranslate nohighlight">\(F_k^{(p,q)}\)</span> is the <span class="math notranslate nohighlight">\(2^m\)</span>-point FFT of the impulse response <span class="math notranslate nohighlight">\(f_{p,q}[n]\)</span>.</p>
</li>
<li><p>For <span class="math notranslate nohighlight">\(p=0,1,\ldots,U-1\)</span>, calculate the <span class="math notranslate nohighlight">\(2^m\)</span>-point inverse FFT <span class="math notranslate nohighlight">\(y_p[n]\)</span> of <span class="math notranslate nohighlight">\(Y_k^{(p)}\)</span>.</p></li>
<li><p>For <span class="math notranslate nohighlight">\(p=0,1,\ldots,U-1\)</span>, “save” the last <span class="math notranslate nohighlight">\(M\)</span> samples of <span class="math notranslate nohighlight">\(y_p[n]\)</span> to get <span class="math notranslate nohighlight">\(\tilde y_p[n]\)</span>.</p></li>
<li><p>Multiplex (<span class="math notranslate nohighlight">\(\uparrow\! U\)</span>) <span class="math notranslate nohighlight">\(\tilde y_0[n], \tilde y_1[n], \ldots, \tilde y_{U-1}[n]\)</span>
into the output signal <span class="math notranslate nohighlight">\(y[n]\)</span>, i.e. <span class="math notranslate nohighlight">\(y[n U + p] = \tilde y_p[n]\)</span>.</p></li>
</ol>
</li>
<li><p>Finally, we simply concatenate all output blocks together to get the
whole output signal <span class="math notranslate nohighlight">\(y[n]\)</span>.</p></li>
<li><p>It remains to choose the FFT size <span class="math notranslate nohighlight">\(2^m\)</span> and <span class="math notranslate nohighlight">\(M\)</span>. As mentioned above,
the length of each polyphase filter <span class="math notranslate nohighlight">\(F_{p,q}(z)\)</span> is at most
<span class="math notranslate nohighlight">\(\left\lceil \frac{L}{UD} \right\rceil+1\)</span>. Hence, we would want to choose
<span class="math notranslate nohighlight">\(M = 2^m- \left\lceil \frac{L}{UD} \right\rceil\)</span> and <span class="math notranslate nohighlight">\(m\)</span> such that
<span class="math notranslate nohighlight">\(m \ll \frac{L}{UD} \ll 2^m\)</span> in order to obtain computational advantage
by using the overlap-save algorithm.</p></li>
<li><p>To study the computational complexity of the polyphase overlap-save
algorithm above, let us assume that all <span class="math notranslate nohighlight">\(F_k^{(p,q)}\)</span>’s are
pre-calculated and stored. To process a block of <span class="math notranslate nohighlight">\(DM\)</span> input samples
of <span class="math notranslate nohighlight">\(x[n]\)</span>, we need:</p>
<ul class="simple">
<li><p>in step 2 above calculates <span class="math notranslate nohighlight">\(D \ 2^m\)</span>-point FFTs and hence requires
<span class="math notranslate nohighlight">\(\mathcal{O}(D m 2^m)\)</span> multiplications,</p></li>
<li><p>in step 3 above calculates <span class="math notranslate nohighlight">\(U\!D \  2^m\)</span>-point multiplications and
hence requires <span class="math notranslate nohighlight">\(\mathcal{O}(UD2^m)\)</span> multiplications, and</p></li>
<li><p>in step 4 above calculates <span class="math notranslate nohighlight">\(U \ 2^m\)</span>-point inverse FFTs and hence
requires <span class="math notranslate nohighlight">\(\mathcal{O}(U m 2^m)\)</span> multiplications.</p></li>
</ul>
<p>As a result, the number of multiplications needed per input sample
is <span class="math notranslate nohighlight">\(\mathcal{O}\left( \max\left\{U, m, \frac{Um}{D} \right\}
\right)\)</span> since <span class="math notranslate nohighlight">\(\frac{L}{UD} \ll 2^m\)</span>. <strong>In conclusion, as long as we
have <span class="math notranslate nohighlight">\(m \max(U,D) \ll L\)</span>, we will get significant advantage in
computational complexity using
the frequency-domain polyphase implementation over using the
time-domain polyphase implementation.</strong></p>
</li>
<li><p>Comparing this frequency-domain polyphase implementation with the
direct frequency-domain multi-rate implementation discussed in
<a class="reference internal" href="multirate.html#sec-multirate"><span class="std std-numref">Section 3.3</span></a> is trickier since the choices of the the FFT
sizes in the two implementations are different. Let the FFT size
used in the direct multi-rate implementation be <span class="math notranslate nohighlight">\(2^{m'}\)</span>. Recall
that from the discussion in <a class="reference internal" href="multirate.html#sec-multirate"><span class="std std-numref">Section 3.3</span></a> we should choose
<span class="math notranslate nohighlight">\(m'D \ll L\ll 2^{m'}\)</span> and the number of multiplications needed per
input sample is <span class="math notranslate nohighlight">\(\mathcal{O}(m' U)\)</span>. On the other hand, we choose
(see above) the FFT size <span class="math notranslate nohighlight">\(2^m\)</span> in the polyphase implementation to
satisfy <span class="math notranslate nohighlight">\(m \ll \frac{L}{UD} \ll 2^m\)</span>. In order to see whether the
frequency-domain polyphase implementation gives any advantage in
computational complexity, we must relate the choices of <span class="math notranslate nohighlight">\(m\)</span> and
<span class="math notranslate nohighlight">\(m'\)</span>:</p>
<ul class="simple">
<li><p>One may choose <span class="math notranslate nohighlight">\(m' = \frac{\max(U,D)}{D} \cdot m\)</span> to get similar
computational complexity advantages over time-domain calculation in
both the direct multi-rate and polyphase implementations. Thus,
expressed in terms of <span class="math notranslate nohighlight">\(m\)</span>, the number of multiplications needed
per input sample for the direct multi-rate implementation is
<span class="math notranslate nohighlight">\(\mathcal{O}\left(\frac{mU}{D} \max(U,D)\right)\)</span>. <strong>Hence,
the number of multiplications needed per input sample by the
frequency-domain polyphase implementation is <span class="math notranslate nohighlight">\(\min\left(
\frac{m}{D}, \frac{U}{D}, 1 \right) \cdot \max(U,D)\)</span> times smaller
than that by the frequency-domain direct multi-rate
implementation.</strong></p></li>
<li><p>Another possibility is to choose <span class="math notranslate nohighlight">\(m' = m + \log_2 (UD)\)</span> to obtain
the same percentage of discarded samples in the overlap-save
algorithms in both the polyphase and direct multi-rate
implementations. <strong>Assuming <span class="math notranslate nohighlight">\(m \gg \log_2 (UD)\)</span>, the number of
multiplications needed per input sample by the frequency-domain
polyphase implementation is <span class="math notranslate nohighlight">\(\min\left( m, U, D \right)\)</span> times
smaller than that by the frequency-domain direct multi-rate
implementation.</strong></p></li>
</ul>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">FilterPolyphase</span></code> class in <a class="reference internal" href="filters_cpp.html#code-filters-cpp"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">filters.cpp</span></code></span></a>
provides an example of implementing the frequency-domain polyphase
filter described above. Note that the second approach of choosing
the FFT size is employed in <code class="docutils literal notranslate"><span class="pre">FilterPolyphase</span></code>.</p></li>
<li><p>For a usage example of <code class="docutils literal notranslate"><span class="pre">FilterPolyphase</span></code>, see
<a class="reference internal" href="test_filters.html#code-test-filters"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">test_filter.cpp</span></code></span></a>.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./ch3"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="multirate.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">3.3. </span>Multi-rate Filtering</p>
      </div>
    </a>
    <a class="right-next"
       href="filter_exs.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">3.5. </span>References and further reading</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#polyphase-structure">3.4.1. Polyphase structure</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#time-domain-polyphase-implementation">3.4.2. Time-domain polyphase implementation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#frequency-domain-polyphase-implementation">3.4.3. Frequency-domain polyphase implementation</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Tan F. Wong
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2016-2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>