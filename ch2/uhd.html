

<!DOCTYPE html>


<html >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>2.1. UHD &#8212; Digital Communications with SDRs</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'ch2/uhd';</script>
    <link rel="canonical" href="wing.ece.ufl.edu/eel6528/ch2/uhd.html" />
    <link rel="shortcut icon" href="../_static/logo.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="2.2. Elementary Multi-threading" href="multithread.html" />
    <link rel="prev" title="2. Some Programming Prelims" href="prelims.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Digital Communications with Software Defined Radios
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../ch1/introduction.html">1. Introduction</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="prelims.html">2. Some Programming Prelims</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">2.1. UHD</a></li>
<li class="toctree-l2"><a class="reference internal" href="multithread.html">2.2. Elementary Multi-threading</a></li>
<li class="toctree-l2"><a class="reference internal" href="prelims_exs.html">2.3. References and further reading</a></li>

</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch3/filter.html">3. Multi-rate Filtering</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch3/fftw3.html">3.1. FFTW3 Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch3/overlapsave.html">3.2. Overlap Save Algorithm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch3/multirate.html">3.3. Multi-rate Filtering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch3/polyphase.html">3.4. Polyphase Filtering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch3/filter_exs.html">3.5. References and further reading</a></li>

</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ch4/part15.html">4. Digest of FCC Regulations Part 15</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch5/usrp.html">5. USRP Tuning and Calibration</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch5/tuning.html">5.1. Frequency Tuning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch5/iq.html">5.2. DC Offset and IQ Imbalance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch5/usrp_refs.html">5.3. References and further reading</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch6/signal.html">6. Signal Generation and Capture</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch6/generate.html">6.1. TX Pulse Shaping</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch6/capture.html">6.2. RX Signal Capture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch6/signal_refs.html">6.3. References and further reading</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch7/sync.html">7. Signal Acquisition and Synchronization</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch7/dll.html">7.1. Closed-Loop Symbol Synchronization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch7/acq.html">7.2. Signal Acquisition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch7/signature.html">7.3. Signature Signal Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch7/mseq.html">7.4. Maximal-length Sequences</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch7/zc.html">7.5. Zadoff–Chu Sequences</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch7/sync_refs.html">7.6. References and further reading</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch8/noncoh.html">8. Non-coherent Demodulation</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch8/mlnoncoh.html">8.1. Maximum Likelihood Non-coherent Demodulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch8/ask.html">8.2. <span class="math notranslate nohighlight">\(M\)</span>-ary Amplitude Shift Keying (<span class="math notranslate nohighlight">\(M\)</span>-ASK)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch8/dpsk.html">8.3. <span class="math notranslate nohighlight">\(M\)</span>-ary Differential Phase Shift Keying (<span class="math notranslate nohighlight">\(M\)</span>-DPSK)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch8/noncoh_usrp.html">8.4. USRP Implementation</a></li>

</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch9/carrier.html">9. Carrier Synchronization</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch9/mlest.html">9.1. Basic Model</a></li>

<li class="toctree-l2"><a class="reference internal" href="../ch9/dd_pll.html">9.3. Decision-directed Phase-locked Loop</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch9/ndd_pll.html">9.4. Non-decision-directed Phase-locked Loop</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch9/carrier_refs.html">9.5. References and further reading</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ch10/coh.html">10. Coherent Demodulation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch11/arq.html">11. Automatic Repeat Request</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch11/crc.html">11.1. Cyclic Redundancy Check Codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch11/protocols.html">11.2. Simple ARQ Protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch11/duplex.html">11.3. Duplex Transmission using USRPs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch11/arq_exs.html">11.4. References and further reading</a></li>

</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/ch2/uhd.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>UHD</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#uhd-safe-main-macro-and-termination-trick">2.1.1. UHD_SAFE_MAIN macro and Termination trick</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#boost-program-options-library">2.1.2. Boost.Program_options Library</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-control-and-query-usrp">2.1.3. Set up, control, and query USRP</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#usrp-streams">2.1.4. USRP Streams</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tx-send-signal-samples-to-usrp">2.1.5. TX: Send signal samples to USRP</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rx-grab-signal-samples-from-usrp">2.1.6. RX: Grab signal samples from USRP</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="uhd">
<span id="sec-uhd"></span><h1><span class="section-number">2.1. </span>UHD<a class="headerlink" href="#uhd" title="Permalink to this headline">#</a></h1>
<ul class="simple">
<li><p>UHD is the C++ device driver for USRP radios.</p></li>
<li><p>It provides APIs to set up, query, and control a USRP radio and to transfer signal samples between the USRP radio and a host computer.</p></li>
<li><p>The version of UHD that we will use in class (installed on <code class="docutils literal notranslate"><span class="pre">wing-radio-a</span></code> and <code class="docutils literal notranslate"><span class="pre">wing-radio-b</span></code>) is <a class="reference external" href="https://files.ettus.com/manual_archive/v3.15.0.0/html/index.html">UHD 3.15.0.0</a>. Note that it is NOT the lastest stable version of UHD, which can be found <a class="reference external" href="https://files.ettus.com/manual/">here</a>.</p></li>
</ul>
<section id="uhd-safe-main-macro-and-termination-trick">
<h2><span class="section-number">2.1.1. </span>UHD_SAFE_MAIN macro and Termination trick<a class="headerlink" href="#uhd-safe-main-macro-and-termination-trick" title="Permalink to this headline">#</a></h2>
<ul>
<li><p><a class="reference internal" href="uhd_safe_main.html#code-uhd-safe-main"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">UHD_SAFE_MAIN</span></code></span></a> is a macro for <code class="docutils literal notranslate"><span class="pre">main()</span></code> that catches and prints out an exception, in case it is thrown, to <code class="docutils literal notranslate"><span class="pre">stderr</span></code>. It is not necessary, but good, to use it.</p></li>
<li><p>In most cases, we want our <code class="docutils literal notranslate"><span class="pre">main()</span></code> and other functions to keep running until we decide otherwise. Thus we need a way to terminate the program. The simplest way to do so is to issue a CTRL-C interrupt. See below for a sample code to catch the CTRL-C interrupt and terminate <code class="docutils literal notranslate"><span class="pre">main()</span></code>.</p></li>
<li><p><u>Example</u>:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;uhd/utils/safe_main.hpp&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;csignal&gt;</span>

<span class="c1">// Interrupt signal handler</span>
<span class="k">static</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">stop_signal_called</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">sig_int_handler</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">stop_signal_called</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">UHD_SAFE_MAIN</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">...</span>
<span class="w">    </span><span class="c1">// Set the signal handler</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">signal</span><span class="p">(</span><span class="n">SIGINT</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sig_int_handler</span><span class="p">);</span>
<span class="w">    </span><span class="p">...</span>
<span class="w">    </span><span class="c1">// Keep running until CTRL-C issued</span>
<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="n">not</span><span class="w"> </span><span class="n">stop_signal_called</span><span class="p">){</span>
<span class="w">        </span><span class="p">...</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">EXIT_SUCCESS</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="boost-program-options-library">
<h2><span class="section-number">2.1.2. </span>Boost.Program_options Library<a class="headerlink" href="#boost-program-options-library" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="http://www.boost.org/">Boost</a> is a huge collection of C++ libraries that help us do many common application tasks. We will mainly use the Boost libraries for option parsing, printing, and sometimes threading. The version of Boost installed installed on <code class="docutils literal notranslate"><span class="pre">wing-radio-a</span></code> and <code class="docutils literal notranslate"><span class="pre">wing-radio-b</span></code> is <a class="reference external" href="https://www.boost.org/doc/libs/1_71_0/">Boost 1.71.0</a>.</p></li>
<li><p>In particular,
<a class="reference external" href="https://www.boost.org/doc/libs/1_71_0/doc/html/program_options.html">Boost.Program_options</a>
library will come in handy when parsing program options.</p></li>
<li><p><u>Example</u>: <a class="reference internal" href="age.html#code-age"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">age.cpp</span></code></span></a></p></li>
</ul>
</section>
<section id="set-up-control-and-query-usrp">
<h2><span class="section-number">2.1.3. </span>Set up, control, and query USRP<a class="headerlink" href="#set-up-control-and-query-usrp" title="Permalink to this headline">#</a></h2>
<ol class="arabic simple">
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">uhd::usrp::multi_usrp</span></code> class method <code class="docutils literal notranslate"><span class="pre">uhd::usrp::multi_usrp::make()</span></code> to construct a USRP object.</p></li>
<li><p>Use other <code class="docutils literal notranslate"><span class="pre">uhd::usrp::multi_usrp</span></code> class APIs to set and query various USRP parameters.</p></li>
</ol>
<ul class="simple">
<li><p>A full list of <code class="docutils literal notranslate"><span class="pre">uhd::usrp::multi_usrp</span></code> class APIs can be found <a class="reference external" href="https://files.ettus.com/manual_archive/v3.15.0.0/html/classuhd_1_1usrp_1_1multi__usrp.html">here</a>.</p></li>
<li><p><u>Example</u>: <a class="reference internal" href="txrx_setup.html#code-txrx-setup"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">txrx_loopback_to_file.cpp</span></code></span></a></p></li>
</ul>
</section>
<section id="usrp-streams">
<h2><span class="section-number">2.1.4. </span>USRP Streams<a class="headerlink" href="#usrp-streams" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>To transmit/receive using a USRP, signal samples need to be
transferred to/from the USRP. This is accomplished
via the Gigabit Ethernet connection between the host computer and
the N210 USRP.</p></li>
<li><p>Signal samples are encapsulated in Ethernet packets that are
transferred between the host computer and USRP. This is referred to
as <strong>streaming</strong>.</p></li>
<li><p>To do streaming, we need to first construct a <strong>stream</strong> object that facilitates streaming between the host computer and USRP. There are two kinds of stream objects:</p>
<ul>
<li><p>A <strong>TX stream</strong> allows the host PC to transmit samples to the
USRP, and is constructed using the
<code class="docutils literal notranslate"><span class="pre">uhd::usrp::multi_usrp::get_tx_stream()</span></code> method, which returns a
smart pointer to a <code class="docutils literal notranslate"><span class="pre">uhd::tx_streamer</span></code> class object.</p></li>
<li><p>An <strong>RX stream</strong> allows the host PC to receive samples from the
USRP, and is constructed using the
<code class="docutils literal notranslate"><span class="pre">uhd::usrp::multi_usrp::get_rx_stream()</span></code> method, which returns a
smart pointer to a <code class="docutils literal notranslate"><span class="pre">uhd::rx_streamer</span></code> class object.</p></li>
</ul>
</li>
<li><p>Both stream construction methods require an input argument of type
<code class="docutils literal notranslate"><span class="pre">uhd::stream_args_t(const</span> <span class="pre">std::string&amp;</span> <span class="pre">cpu,</span> <span class="pre">const</span> <span class="pre">std::string&amp;</span> <span class="pre">otw)</span></code>, where <code class="docutils literal notranslate"><span class="pre">cpu</span></code> and <code class="docutils literal notranslate"><span class="pre">otw</span></code> represent the different data types of
signal samples at the two ends of a stream:</p>
<ul>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">cpu</span></code> specifies the host data type:</strong> Data type of the samples used on the
host for processing, possible choices are  <code class="docutils literal notranslate"><span class="pre">fc64</span></code>, <code class="docutils literal notranslate"><span class="pre">fc32</span></code>, <code class="docutils literal notranslate"><span class="pre">sc16</span></code>, and <code class="docutils literal notranslate"><span class="pre">sc8</span></code>.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">otw</span></code> specifies USRP over-the-wire data type:</strong> Data type of the samples sent through Ethernet, possible choices are <code class="docutils literal notranslate"><span class="pre">sc16</span></code> and <code class="docutils literal notranslate"><span class="pre">sc8</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fc64</span></code> = <code class="docutils literal notranslate"><span class="pre">std::complex&lt;double&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">fc32</span></code> = <code class="docutils literal notranslate"><span class="pre">std::complex&lt;float&gt;</span></code>,
<code class="docutils literal notranslate"><span class="pre">sc16</span></code> = <code class="docutils literal notranslate"><span class="pre">std::complex&lt;int16_t&gt;</span></code>, and <code class="docutils literal notranslate"><span class="pre">sc8</span></code> = <code class="docutils literal notranslate"><span class="pre">std::complex&lt;int8_t&gt;</span></code>.</p></li>
<li><p>See <a class="reference internal" href="stream.html#code-stream"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">stream.hpp</span></code></span></a> in the UHD source package for
detailed specifications of the sample data types above, as well
as other additional fields in <code class="docutils literal notranslate"><span class="pre">uhd::stream_args_t</span></code>.</p></li>
</ul>
</li>
<li><p>Data-type conversion is automatically carried out by the stream
objects.</p></li>
<li><p><u>Example</u>: <a class="reference internal" href="txrx_stream.html#code-txrx-stream"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">txrx_loopback_to_file.cpp</span></code></span></a></p></li>
</ul>
</section>
<section id="tx-send-signal-samples-to-usrp">
<h2><span class="section-number">2.1.5. </span>TX: Send signal samples to USRP<a class="headerlink" href="#tx-send-signal-samples-to-usrp" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>After a TX stream object is constructed, we may use the method
<code class="docutils literal notranslate"><span class="pre">uhd::tx_streamer::send()</span></code> to transfer signal samples from the host
to the USRP. See code examples below and <a class="reference internal" href="stream.html#code-stream"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">stream.hpp</span></code></span></a>
to see all input arguments of <code class="docutils literal notranslate"><span class="pre">uhd::tx_streamer::send()</span></code>. The method
<code class="docutils literal notranslate"><span class="pre">uhd::tx_streamer::send()</span></code> is a blocking call and will not return
until the specified number of samples have been read out of from the
buffer, unless a timeout occurs.</p></li>
<li><p>Note that the samples are encapsulated into Ethernet packets for the
stream transfer. Each packet can only carry a certain maximum number
of samples, which is determined by the Ethernet hardware and the
amount of buffering in the USRP and the host. This maximum number
can be obtained using the <code class="docutils literal notranslate"><span class="pre">uhd::tx_streamer::get_max_num_samps()</span></code>
method.</p></li>
<li><p>If the total number of samples is greater than this maximum number,
then we have to chop up the samples into multiple Ethernet packets
and send them to the USRP in a <em>burst</em>. This may be done
manually. However, <code class="docutils literal notranslate"><span class="pre">uhd::tx_streamer::send()</span></code> will automatically do
that for us. Specifically, it will fragment the samples across
several packets.  I recommend letting <code class="docutils literal notranslate"><span class="pre">uhd::tx_streamer::send()</span></code>
handle that.</p></li>
<li><p>In either case, we need to tell the USRP when the burst starts and
ends. This is done by setting <code class="docutils literal notranslate"><span class="pre">start_of_burst</span></code> and <code class="docutils literal notranslate"><span class="pre">end_of_burst</span></code>
flags in a metadata structure of type <code class="docutils literal notranslate"><span class="pre">uhd::tx_metadata_t</span></code>
associated with each call to <code class="docutils literal notranslate"><span class="pre">uhd::tx_streamer::send()</span></code>. See code
examples below for different ways to set and use these parameters.
In the case of auto-fragmentation, <code class="docutils literal notranslate"><span class="pre">uhd::tx_streamer::send()</span></code> will
respect the burst flags when fragmenting to ensure that
<code class="docutils literal notranslate"><span class="pre">start_of_burst</span></code> can only be set on the first fragment and that
<code class="docutils literal notranslate"><span class="pre">end_of_burst</span></code> can only be set on the final fragment.</p></li>
<li><p>Also we can ask UHD to stream the samples immediately by setting the
value of the <code class="docutils literal notranslate"><span class="pre">has_time_spec</span></code> field to <code class="docutils literal notranslate"><span class="pre">false</span></code> (which is the default
value) in the metadata. Or we may ask UHD to not start streaming
before a certain time. See the
<a class="reference internal" href="txrx_TX.html#code-txrx-tx"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">txrx_loopback_to_file.cpp</span></code></span></a> example below for how to
do that.</p></li>
<li><p>After the USRP receives the samples, it takes over the actual
digital up conversion, D/A conversion, carrier mixing, filtering,
and transmission processes.</p></li>
<li><p>One needs to be aware of the fact that there is a certain latency
from sending the first packet of samples using
<code class="docutils literal notranslate"><span class="pre">uhd::tx_streamer::send()</span></code> to the actual physical transmission of
the signal. This latency may vary with the host computer’s load and
the traffic load over the Ethernet connection.</p></li>
<li><p>The USRP consumes, and hence expects, samples coming in at a
constant rate. An underflow occurs when the host does not produce (or
send) samples fast enough. When UHD detects the underflow, it prints a
“U” to <code class="docutils literal notranslate"><span class="pre">stdout</span></code>, and pushes a message packet into the async message
stream back to the host.</p></li>
<li><p><u>Example of transmitting a burst of samples:</u> <a class="reference internal" href="tx_samples_from_file.html#code-tx-samples"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">tx_samples_from_file.cpp</span></code></span></a></p></li>
<li><p><u>Example of continuous transmission:</u> <a class="reference internal" href="txrx_TX.html#code-txrx-tx"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">txrx_loopback_to_file.cpp</span></code></span></a></p></li>
</ul>
</section>
<section id="rx-grab-signal-samples-from-usrp">
<h2><span class="section-number">2.1.6. </span>RX: Grab signal samples from USRP<a class="headerlink" href="#rx-grab-signal-samples-from-usrp" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>After a RX stream object is constructed, we may use the method
<code class="docutils literal notranslate"><span class="pre">uhd::rx_streamer::recv()</span></code> to transfer signal samples from the USRP
to the host.</p></li>
<li><p>Note that the samples are encapsulated into Ethernet packets for the
stream transfer.  Each packet can only carry a certain maximum
number of samples, which is determined by the Ethernet hardware and
the amount of buffering in the USRP and the host. This maximum
number can be obtained using the
<code class="docutils literal notranslate"><span class="pre">uhd::rx_streamer::get_max_num_samps()</span></code> method. By default, UHD
sends this maximum number of samples.  One may specify the number of
samples to be transferred per packet by setting the <code class="docutils literal notranslate"><span class="pre">spp</span></code> field in
the <code class="docutils literal notranslate"><span class="pre">uhd::stream_args_t::args</span></code> structure when constructing the RX
stream. See <a class="reference internal" href="stream.html#code-stream"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">stream.hpp</span></code></span></a> for details.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">uhd::rx_streamer::recv()</span></code> method is a blocking call and will
not return until the number of samples specified have been written
into the buffer, unless a timeout occurs. Refer to the code example
below and <a class="reference internal" href="stream.html#code-stream"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">stream.hpp</span></code></span></a> for how to specify the number
of samples to receive and to see all input arguments of
<code class="docutils literal notranslate"><span class="pre">uhd::rx_streamer::recv()</span></code>.</p></li>
<li><p>On the other hand, if the buffer has insufficient space (the
specified number of samples) to hold all samples that were received
in a single packet from the USRP, then the buffer will be completely
filled and <code class="docutils literal notranslate"><span class="pre">uhd::rx_streamer::recv()</span></code> will hold a pointer into the
remaining portion of the packet. Subsequent calls will load from the
remainder of the packet, and will properly set the <code class="docutils literal notranslate"><span class="pre">start_of_burst</span></code>,
<code class="docutils literal notranslate"><span class="pre">end_of_burst</span></code>, and <code class="docutils literal notranslate"><span class="pre">fragment_offset</span></code> fields in the returned
<code class="docutils literal notranslate"><span class="pre">uhd::rx_metadata_t</span></code> structure to show that this is a fragment (see
<a class="reference external" href="https://files.ettus.com/manual_archive/v3.15.0.0/html/structuhd_1_1rx__metadata__t.html"></a>
for details). The next call to receive, after the remainder becomes
exhausted, will get a new packet from the USRP as usual.</p></li>
<li><p>There are two different modes of streaming samples from the USRP,
namely <strong>continuous</strong> and <strong>fixed-number-of-samples</strong>. Operations of
both modes are controlled by issuing a <strong>stream command</strong> to the
USRP using the <code class="docutils literal notranslate"><span class="pre">uhd::rx_streamer::issue_stream_cmd()</span></code> method. See
the code example below for how to use the method.</p></li>
<li><p>A stream command is of the <code class="docutils literal notranslate"><span class="pre">uhd::stream_cmd_t</span></code> type, and the
different modes of streaming can be specified by setting the
<code class="docutils literal notranslate"><span class="pre">stream_mode</span></code> field or by using the constructor of
<code class="docutils literal notranslate"><span class="pre">uhd::stream_cmd_t</span></code>. Possible options for <code class="docutils literal notranslate"><span class="pre">stream_mode</span></code> include:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">STREAM_MODE_START_CONTINUOUS</span></code> tells the USRP to stream samples
indefinitely</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">STREAM_MODE_STOP_CONTINUOUS</span></code> tells the USRP to end continuous
streaming</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">STREAM_MODE_NUM_SAMPS_AND_DONE</span></code> tells the USRP to stream
<code class="docutils literal notranslate"><span class="pre">num_samps</span></code> samples and to not expect a future stream command for
contiguous samples</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">STREAM_MODE_NUM_SAMPS_AND_MORE</span></code> tells the USRP to stream
<code class="docutils literal notranslate"><span class="pre">num_samps</span></code> samples and to expect a future stream command for
contiguous samples.</p></li>
</ul>
</li>
<li><p>We will mostly do continuous streaming later. Once the stream
command is issued, the USRP will automatically take over the actual
receiving, frequency mixing, A/D conversion, filtering, digital down
sampling, buffering, and transfer of the signal samples to the
host.</p></li>
<li><p>One may specify the number of requested samples for the
fixed-number-of-samples mode of streaming by setting the
<code class="docutils literal notranslate"><span class="pre">num_samps</span></code> field in the stream command. Also one can
tell the USRP to start streaming immediately by setting the
<code class="docutils literal notranslate"><span class="pre">stream_now</span></code> field in the stream command to <code class="docutils literal notranslate"><span class="pre">true</span></code> or at a later
specific time by specifying the <code class="docutils literal notranslate"><span class="pre">time_spec</span></code> field. See the code
example below for how to set the <code class="docutils literal notranslate"><span class="pre">time_spec</span></code> field.</p></li>
<li><p>A RX metadata structure <code class="docutils literal notranslate"><span class="pre">uhd::rx_metadata_t</span></code> is available to describe
information about the streaming process and the sample packet. Most
useful to us will be the <code class="docutils literal notranslate"><span class="pre">error_code</span></code> field of the RX metadata. The
possible flags of the field are:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ERROR_CODE_NONE</span></code>: no error associated with this metadata</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ERROR_CODE_TIMEOUT</span></code>: no packet received, implementation timed-out</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ERROR_CODE_LATE_COMMAND</span></code>: a stream command was issued in the past</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ERROR_CODE_BROKEN_CHAIN</span></code>: expected another stream command</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ERROR_CODE_OVERFLOW</span></code>: an overflow has occurred</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ERROR_CODE_ALIGNMENT</span></code>: ,ulti-channel alignment failed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ERROR_CODE_BAD_PACKET</span></code>: the packet could not be parsed</p></li>
</ul>
</li>
<li><p>One may use the <code class="docutils literal notranslate"><span class="pre">uhd::rx_metadata_t</span> <span class="pre">::strerror()</span></code> method to print out the error.</p></li>
<li><p>The most common error is an overflow which occurs when the host does
not consume data provided by the USRP fast enough. When UHD detects
the overflow, it prints an “O” or “D” to <code class="docutils literal notranslate"><span class="pre">stdout</span></code>, and pushes a
message packet into the RX stream.</p></li>
<li><p><u>Example</u>: <a class="reference internal" href="txrx_RX.html#code-txrx-rx"><span class="std std-ref">txrx_loopback_to_file.cpp (RX)</span></a></p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./ch2"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="prelims.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">2. </span>Some Programming Prelims</p>
      </div>
    </a>
    <a class="right-next"
       href="multithread.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">2.2. </span>Elementary Multi-threading</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#uhd-safe-main-macro-and-termination-trick">2.1.1. UHD_SAFE_MAIN macro and Termination trick</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#boost-program-options-library">2.1.2. Boost.Program_options Library</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-control-and-query-usrp">2.1.3. Set up, control, and query USRP</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#usrp-streams">2.1.4. USRP Streams</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tx-send-signal-samples-to-usrp">2.1.5. TX: Send signal samples to USRP</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rx-grab-signal-samples-from-usrp">2.1.6. RX: Grab signal samples from USRP</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Tan F. Wong
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>