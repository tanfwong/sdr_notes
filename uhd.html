
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>2.1. UHD &#8212; Digital Communications with SDRs</title>
    
  <link rel="stylesheet" href="_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="wing.ece.ufl.edu/eel6528/uhd.html" />
    <link rel="shortcut icon" href="_static/logo.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="2.2. Elementary Multi-threading" href="multithread.html" />
    <link rel="prev" title="2. Some Programming Prelims" href="prelims.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />


<!-- Opengraph tags -->
<meta property="og:url"         content="wing.ece.ufl.edu/eel6528/uhd.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="UHD" />
<meta property="og:description" content="UHD  UHD is the C++ device driver for USRP radios.  It provides APIs to set up, query, and control a USRP radio and to transfer signal samples between the USRP " />
<meta property="og:image"       content="wing.ece.ufl.edu/eel6528/_static/logo.png" />

<meta name="twitter:card" content="summary" />


  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  <img src="_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Digital Communications with SDRs</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   EEL6528 Digital Communications with Software Defined Radios
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="introduction.html">
   1. Introduction
  </a>
 </li>
 <li class="toctree-l1 current active collapsible-parent">
  <a class="reference internal" href="prelims.html">
   2. Some Programming Prelims
  </a>
  <ul class="current collapse-ul">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     2.1. UHD
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="multithread.html">
     2.2. Elementary Multi-threading
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="prelims_exs.html">
     2.3. References and further reading
    </a>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="prelims_exs.html#code-examples">
     2.4. Code Examples
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="uhd_safe_main.html">
       2.4.1.
       <code class="docutils literal notranslate">
        <span class="pre">
         uhd_safe_main.hpp
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="age.html">
       2.4.2.
       <code class="docutils literal notranslate">
        <span class="pre">
         age.cpp
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="txrx_setup.html">
       2.4.3.
       <code class="docutils literal notranslate">
        <span class="pre">
         txrx_loopback_to_file.cpp
        </span>
       </code>
       (setup)
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="txrx_stream.html">
       2.4.4.
       <code class="docutils literal notranslate">
        <span class="pre">
         txrx_loopback_to_file.cpp
        </span>
       </code>
       (stream)
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="stream.html">
       2.4.5.
       <code class="docutils literal notranslate">
        <span class="pre">
         stream.hpp
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tx_samples_from_file.html">
       2.4.6.
       <code class="docutils literal notranslate">
        <span class="pre">
         tx_samples_from_file.cpp
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="txrx_TX.html">
       2.4.7.
       <code class="docutils literal notranslate">
        <span class="pre">
         txrx_loopback_to_file.cpp
        </span>
       </code>
       (TX)
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="txrx_RX.html">
       2.4.8.
       <code class="docutils literal notranslate">
        <span class="pre">
         txrx_loopback_to_file.cpp
        </span>
       </code>
       (RX)
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="age_threads.html">
       2.4.9.
       <code class="docutils literal notranslate">
        <span class="pre">
         age_threads.cpp
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="txrx_thread.html">
       2.4.10.
       <code class="docutils literal notranslate">
        <span class="pre">
         txrx_loopback_to_file.cpp
        </span>
       </code>
       (thread)
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="age_mutex.html">
       2.4.11.
       <code class="docutils literal notranslate">
        <span class="pre">
         age_mutex.cpp
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="age_mutex_caller.html">
       2.4.12.
       <code class="docutils literal notranslate">
        <span class="pre">
         age_mutex_caller.cpp
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="count_atomic.html">
       2.4.13.
       <code class="docutils literal notranslate">
        <span class="pre">
         count_atomic.cpp
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="queue.html">
       2.4.14.
       <code class="docutils literal notranslate">
        <span class="pre">
         queue.hpp
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="age_fifo.html">
       2.4.15.
       <code class="docutils literal notranslate">
        <span class="pre">
         age_fifo.cpp
        </span>
       </code>
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="filter.html">
   3. Multi-rate Filtering
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="fftw3.html">
     3.1. FFTW3 Library
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="filter_exs.html">
     3.2. References and further reading
    </a>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="filter_exs.html#code-examples">
     3.3. Code Examples
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="fft.html">
       3.3.1.
       <code class="docutils literal notranslate">
        <span class="pre">
         fft.hpp
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="test_fft.html">
       3.3.2.
       <code class="docutils literal notranslate">
        <span class="pre">
         test_fft.cpp
        </span>
       </code>
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/uhd.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#uhd-safe-main-macro-and-termination-trick">
   2.1.1. UHD_SAFE_MAIN macro and Termination trick
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#boost-program-options-library">
   2.1.2. Boost.Program_options Library
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#set-up-control-and-query-usrp">
   2.1.3. Set up, control, and query USRP
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#usrp-streams">
   2.1.4. USRP Streams
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tx-send-signal-samples-to-usrp">
   2.1.5. TX: Send signal samples to USRP
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#rx-grab-signal-samples-from-usrp">
   2.1.6. RX: Grab signal samples from USRP
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="uhd">
<span id="sec-uhd"></span><h1><span class="section-number">2.1. </span>UHD<a class="headerlink" href="#uhd" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>UHD is the C++ device driver for USRP radios.</p></li>
<li><p>It provides APIs to set up, query, and control a USRP radio and to transfer signal samples between the USRP radio and a host computer.</p></li>
<li><p>The version of UHD that we will use in class (installed on <code class="docutils literal notranslate"><span class="pre">wing-radio-a</span></code> and <code class="docutils literal notranslate"><span class="pre">wing-radio-b</span></code>) is <a class="reference external" href="https://files.ettus.com/manual_archive/v3.15.0.0/html/index.html">UHD 3.15.0.0</a>. Note that it is NOT the lastest stable version of UHD, which can be found <a class="reference external" href="https://files.ettus.com/manual/">here</a>.</p></li>
</ul>
<div class="section" id="uhd-safe-main-macro-and-termination-trick">
<h2><span class="section-number">2.1.1. </span>UHD_SAFE_MAIN macro and Termination trick<a class="headerlink" href="#uhd-safe-main-macro-and-termination-trick" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p><a class="reference internal" href="uhd_safe_main.html#code-uhd-safe-main"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">UHD_SAFE_MAIN</span></code></span></a> is a macro for <code class="docutils literal notranslate"><span class="pre">main()</span></code> that catches and prints out an exception, in case it is thrown, to <code class="docutils literal notranslate"><span class="pre">stderr</span></code>. It is not necessary, but good, to use it.</p></li>
<li><p>In most cases, we want our <code class="docutils literal notranslate"><span class="pre">main()</span></code> and other functions to keep running until we decide otherwise. Thus we need a way to terminate the program. The simplest way to do so is to issue a CTRL-C interrupt. See below for a sample code to catch the CTRL-C interrupt and terminate <code class="docutils literal notranslate"><span class="pre">main()</span></code>.</p></li>
<li><p><u>Example</u>:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;uhd/utils/safe_main.hpp&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;csignal&gt;</span><span class="cp"></span>

<span class="c1">// Interrupt signal handler</span>
<span class="k">static</span> <span class="kt">bool</span> <span class="n">stop_signal_called</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">sig_int_handler</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">stop_signal_called</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">UHD_SAFE_MAIN</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
    <span class="p">...</span>
    <span class="c1">// Set the signal handler</span>
    <span class="n">std</span><span class="o">::</span><span class="n">signal</span><span class="p">(</span><span class="n">SIGINT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sig_int_handler</span><span class="p">);</span>
    <span class="p">...</span>
    <span class="c1">// Keep running until CTRL-C issued</span>
    <span class="k">while</span><span class="p">(</span><span class="n">not</span> <span class="n">stop_signal_called</span><span class="p">){</span>
        <span class="p">...</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="boost-program-options-library">
<h2><span class="section-number">2.1.2. </span>Boost.Program_options Library<a class="headerlink" href="#boost-program-options-library" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="http://www.boost.org/">Boost</a> is a huge collection of C++ libraries that help us do many common application tasks. We will mainly use the Boost libraries for option parsing, printing, and sometimes threading. The version of Boost installed installed on <code class="docutils literal notranslate"><span class="pre">wing-radio-a</span></code> and <code class="docutils literal notranslate"><span class="pre">wing-radio-b</span></code> is <a class="reference external" href="https://www.boost.org/doc/libs/1_71_0/">Boost 1.71.0</a>.</p></li>
<li><p>In particular,
<a class="reference external" href="https://www.boost.org/doc/libs/1_71_0/doc/html/program_options.html">Boost.Program_options</a>
library will come in handy when parsing program options.</p></li>
<li><p><u>Example</u>: <a class="reference internal" href="age.html#code-age"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">age.cpp</span></code></span></a></p></li>
</ul>
</div>
<div class="section" id="set-up-control-and-query-usrp">
<h2><span class="section-number">2.1.3. </span>Set up, control, and query USRP<a class="headerlink" href="#set-up-control-and-query-usrp" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">uhd::usrp::multi_usrp</span></code> class method <code class="docutils literal notranslate"><span class="pre">uhd::usrp::multi_usrp::make()</span></code> to construct a USRP object.</p></li>
<li><p>Use other <code class="docutils literal notranslate"><span class="pre">uhd::usrp::multi_usrp</span></code> class APIs to set and query various USRP parameters.</p></li>
</ol>
<ul class="simple">
<li><p>A full list of <code class="docutils literal notranslate"><span class="pre">uhd::usrp::multi_usrp</span></code> class APIs can be found <a class="reference external" href="https://files.ettus.com/manual_archive/v3.15.0.0/html/classuhd_1_1usrp_1_1multi__usrp.html">here</a>.</p></li>
<li><p><u>Example</u>: <a class="reference internal" href="txrx_setup.html#code-txrx-setup"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">txrx_loopback_to_file.cpp</span></code></span></a></p></li>
</ul>
</div>
<div class="section" id="usrp-streams">
<h2><span class="section-number">2.1.4. </span>USRP Streams<a class="headerlink" href="#usrp-streams" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>To transmit/receive using a USRP, signal samples need to be
transferred to/from the USRP. This is accomplished
via the Gigabit Ethernet connection between the host computer and
the N210 USRP.</p></li>
<li><p>Signal samples are encapsulated in Ethernet packets that are
transferred between the host computer and USRP. This is referred to
as <strong>streaming</strong>.</p></li>
<li><p>To do streaming, we need to first construct a <strong>stream</strong> object that facilitates streaming between the host computer and USRP. There are two kinds of stream objects:</p>
<ul>
<li><p>A <strong>TX stream</strong> allows the host PC to transmit samples to the
USRP, and is constructed using the
<code class="docutils literal notranslate"><span class="pre">uhd::usrp::multi_usrp::get_tx_stream()</span></code> method, which returns a
smart pointer to a <code class="docutils literal notranslate"><span class="pre">uhd::tx_streamer</span></code> class object.</p></li>
<li><p>An <strong>RX stream</strong> allows the host PC to receive samples from the
USRP, and is constructed using the
<code class="docutils literal notranslate"><span class="pre">uhd::usrp::multi_usrp::get_rx_stream()</span></code> method, which returns a
smart pointer to a <code class="docutils literal notranslate"><span class="pre">uhd::rx_streamer</span></code> class object.</p></li>
</ul>
</li>
<li><p>Both stream construction methods require an input argument of type
<code class="docutils literal notranslate"><span class="pre">uhd::stream_args_t(const</span> <span class="pre">std::string&amp;</span> <span class="pre">cpu,</span> <span class="pre">const</span> <span class="pre">std::string&amp;</span> <span class="pre">otw)</span></code>, where <code class="docutils literal notranslate"><span class="pre">cpu</span></code> and <code class="docutils literal notranslate"><span class="pre">otw</span></code> represent the different data types of
signal samples at the two ends of a stream:</p>
<ul>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">cpu</span></code> specifies the host data type:</strong> Data type of the samples used on the
host for processing, possible choices are  <code class="docutils literal notranslate"><span class="pre">fc64</span></code>, <code class="docutils literal notranslate"><span class="pre">fc32</span></code>, <code class="docutils literal notranslate"><span class="pre">sc16</span></code>, and <code class="docutils literal notranslate"><span class="pre">sc8</span></code>.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">otw</span></code> specifies USRP over-the-wire data type:</strong> Data type of the samples sent through Ethernet, possible choices are <code class="docutils literal notranslate"><span class="pre">sc16</span></code> and <code class="docutils literal notranslate"><span class="pre">sc8</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fc64</span></code> = <code class="docutils literal notranslate"><span class="pre">std::complex&lt;double&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">fc32</span></code> = <code class="docutils literal notranslate"><span class="pre">std::complex&lt;float&gt;</span></code>,
<code class="docutils literal notranslate"><span class="pre">sc16</span></code> = <code class="docutils literal notranslate"><span class="pre">std::complex&lt;int16_t&gt;</span></code>, and <code class="docutils literal notranslate"><span class="pre">sc8</span></code> = <code class="docutils literal notranslate"><span class="pre">std::complex&lt;int8_t&gt;</span></code>.</p></li>
<li><p>See <a class="reference internal" href="stream.html#code-stream"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">stream.hpp</span></code></span></a> in the UHD source package for
detailed specifications of the sample data types above, as well
as other additional fields in <code class="docutils literal notranslate"><span class="pre">uhd::stream_args_t</span></code>.</p></li>
</ul>
</li>
<li><p>Data-type conversion is automatically carried out by the stream
objects.</p></li>
<li><p><u>Example</u>: <a class="reference internal" href="txrx_stream.html#code-txrx-stream"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">txrx_loopback_to_file.cpp</span></code></span></a></p></li>
</ul>
</div>
<div class="section" id="tx-send-signal-samples-to-usrp">
<h2><span class="section-number">2.1.5. </span>TX: Send signal samples to USRP<a class="headerlink" href="#tx-send-signal-samples-to-usrp" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>After a TX stream object is constructed, we may use the method
<code class="docutils literal notranslate"><span class="pre">uhd::tx_streamer::send()</span></code> to transfer signal samples from the host
to the USRP. See code examples below and <a class="reference internal" href="stream.html#code-stream"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">stream.hpp</span></code></span></a>
to see all input arguments of <code class="docutils literal notranslate"><span class="pre">uhd::tx_streamer::send()</span></code>. The method
<code class="docutils literal notranslate"><span class="pre">uhd::tx_streamer::send()</span></code> is a blocking call and will not return
until the specified number of samples have been read out of from the
buffer, unless a timeout occurs.</p></li>
<li><p>Note that the samples are encapsulated into Ethernet packets for the
stream transfer. Each packet can only carry a certain maximum number
of samples, which is determined by the Ethernet hardware and the
amount of buffering in the USRP and the host. This maximum number
can be obtained using the <code class="docutils literal notranslate"><span class="pre">uhd::tx_streamer::get_max_num_samps()</span></code>
method.</p></li>
<li><p>If the total number of samples is greater than this maximum number,
then we have to chop up the samples into multiple Ethernet packets
and send them to the USRP in a <em>burst</em>. This may be done
manually. However, <code class="docutils literal notranslate"><span class="pre">uhd::tx_streamer::send()</span></code> will automatically do
that for us. Specifically, it will fragment the samples across
several packets.  I recommend letting <code class="docutils literal notranslate"><span class="pre">uhd::tx_streamer::send()</span></code>
handle that.</p></li>
<li><p>In either case, we need to tell the USRP when the burst starts and
ends. This is done by setting <code class="docutils literal notranslate"><span class="pre">start_of_burst</span></code> and <code class="docutils literal notranslate"><span class="pre">end_of_burst</span></code>
flags in a metadata structure of type <code class="docutils literal notranslate"><span class="pre">uhd::tx_metadata_t</span></code>
associated with each call to <code class="docutils literal notranslate"><span class="pre">uhd::tx_streamer::send()</span></code>. See code
examples below for different ways to set and use these parameters.
In the case of auto-fragmentation, <code class="docutils literal notranslate"><span class="pre">uhd::tx_streamer::send()</span></code> will
respect the burst flags when fragmenting to ensure that
<code class="docutils literal notranslate"><span class="pre">start_of_burst</span></code> can only be set on the first fragment and that
<code class="docutils literal notranslate"><span class="pre">end_of_burst</span></code> can only be set on the final fragment.</p></li>
<li><p>Also we can ask UHD to stream the samples immediately by setting the
value of the <code class="docutils literal notranslate"><span class="pre">has_time_spec</span></code> field to <code class="docutils literal notranslate"><span class="pre">false</span></code> (which is the default
value) in the metadata. Or we may ask UHD to not start streaming
before a certain time. See the
<a class="reference internal" href="txrx_TX.html#code-txrx-tx"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">txrx_loopback_to_file.cpp</span></code></span></a> example below for how to
do that.</p></li>
<li><p>After the USRP receives the samples, it takes over the actual
digital up conversion, D/A conversion, carrier mixing, filtering,
and transmission processes.</p></li>
<li><p>One needs to be aware of the fact that there is a certain latency
from sending the first packet of samples using
<code class="docutils literal notranslate"><span class="pre">uhd::tx_streamer::send()</span></code> to the actual physical transmission of
the signal. This latency may vary with the host computer’s load and
the traffic load over the Ethernet connection.</p></li>
<li><p>The USRP consumes, and hence expects, samples coming in at a
constant rate. An underflow occurs when the host does not produce (or
send) samples fast enough. When UHD detects the underflow, it prints a
“U” to <code class="docutils literal notranslate"><span class="pre">stdout</span></code>, and pushes a message packet into the async message
stream back to the host.</p></li>
<li><p><u>Example of transmitting a burst of samples:</u> <a class="reference internal" href="tx_samples_from_file.html#code-tx-samples"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">tx_samples_from_file.cpp</span></code></span></a></p></li>
<li><p><u>Example of continuous transmission:</u> <a class="reference internal" href="txrx_TX.html#code-txrx-tx"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">txrx_loopback_to_file.cpp</span></code></span></a></p></li>
</ul>
</div>
<div class="section" id="rx-grab-signal-samples-from-usrp">
<h2><span class="section-number">2.1.6. </span>RX: Grab signal samples from USRP<a class="headerlink" href="#rx-grab-signal-samples-from-usrp" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>After a RX stream object is constructed, we may use the method
<code class="docutils literal notranslate"><span class="pre">uhd::rx_streamer::recv()</span></code> to transfer signal samples from the USRP
to the host.</p></li>
<li><p>Note that the samples are encapsulated into Ethernet packets for the
stream transfer.  Each packet can only carry a certain maximum
number of samples, which is determined by the Ethernet hardware and
the amount of buffering in the USRP and the host. This maximum
number can be obtained using the
<code class="docutils literal notranslate"><span class="pre">uhd::rx_streamer::get_max_num_samps()</span></code> method. By default, UHD
sends this maximum number of samples.  One may specify the number of
samples to be transferred per packet by setting the <code class="docutils literal notranslate"><span class="pre">spp</span></code> field in
the <code class="docutils literal notranslate"><span class="pre">uhd::stream_args_t::args</span></code> structure when constructing the RX
stream. See <a class="reference internal" href="stream.html#code-stream"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">stream.hpp</span></code></span></a> for details.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">uhd::rx_streamer::recv()</span></code> method is a blocking call and will
not return until the number of samples specified have been written
into the buffer, unless a timeout occurs. Refer to the code example
below and <a class="reference internal" href="stream.html#code-stream"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">stream.hpp</span></code></span></a> for how to specify the number
of samples to receive and to see all input arguments of
<code class="docutils literal notranslate"><span class="pre">uhd::rx_streamer::recv()</span></code>.</p></li>
<li><p>On the other hand, if the buffer has insufficient space (the
specified number of samples) to hold all samples that were received
in a single packet from the USRP, then the buffer will be completely
filled and <code class="docutils literal notranslate"><span class="pre">uhd::rx_streamer::recv()</span></code> will hold a pointer into the
remaining portion of the packet. Subsequent calls will load from the
remainder of the packet, and will properly set the <code class="docutils literal notranslate"><span class="pre">start_of_burst</span></code>,
<code class="docutils literal notranslate"><span class="pre">end_of_burst</span></code>, and <code class="docutils literal notranslate"><span class="pre">fragment_offset</span></code> fields in the returned
<code class="docutils literal notranslate"><span class="pre">uhd::rx_metadata_t</span></code> structure to show that this is a fragment (see
<a class="reference external" href="https://files.ettus.com/manual_archive/v3.15.0.0/html/structuhd_1_1rx__metadata__t.html"></a>
for details). The next call to receive, after the remainder becomes
exhausted, will get a new packet from the USRP as usual.</p></li>
<li><p>There are two different modes of streaming samples from the USRP,
namely <strong>continuous</strong> and <strong>fixed-number-of-samples</strong>. Operations of
both modes are controlled by issuing a <strong>stream command</strong> to the
USRP using the <code class="docutils literal notranslate"><span class="pre">uhd::rx_streamer::issue_stream_cmd()</span></code> method. See
the code example below for how to use the method.</p></li>
<li><p>A stream command is of the <code class="docutils literal notranslate"><span class="pre">uhd::stream_cmd_t</span></code> type, and the
different modes of streaming can be specified by setting the
<code class="docutils literal notranslate"><span class="pre">stream_mode</span></code> field or by using the constructor of
<code class="docutils literal notranslate"><span class="pre">uhd::stream_cmd_t</span></code>. Possible options for <code class="docutils literal notranslate"><span class="pre">stream_mode</span></code> include:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">STREAM_MODE_START_CONTINUOUS</span></code> tells the USRP to stream samples
indefinitely</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">STREAM_MODE_STOP_CONTINUOUS</span></code> tells the USRP to end continuous
streaming</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">STREAM_MODE_NUM_SAMPS_AND_DONE</span></code> tells the USRP to stream
<code class="docutils literal notranslate"><span class="pre">num_samps</span></code> samples and to not expect a future stream command for
contiguous samples</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">STREAM_MODE_NUM_SAMPS_AND_MORE</span></code> tells the USRP to stream
<code class="docutils literal notranslate"><span class="pre">num_samps</span></code> samples and to expect a future stream command for
contiguous samples.</p></li>
</ul>
</li>
<li><p>We will mostly do continuous streaming later. Once the stream
command is issued, the USRP will automatically take over the actual
receiving, frequency mixing, A/D conversion, filtering, digital down
sampling, buffering, and transfer of the signal samples to the
host.</p></li>
<li><p>One may specify the number of requested samples for the
fixed-number-of-samples mode of streaming by setting the
<code class="docutils literal notranslate"><span class="pre">num_samps</span></code> field in the stream command. Also one can
tell the USRP to start streaming immediately by setting the
<code class="docutils literal notranslate"><span class="pre">stream_now</span></code> field in the stream command to <code class="docutils literal notranslate"><span class="pre">true</span></code> or at a later
specific time by specifying the <code class="docutils literal notranslate"><span class="pre">time_spec</span></code> field. See the code
example below for how to set the <code class="docutils literal notranslate"><span class="pre">time_spec</span></code> field.</p></li>
<li><p>A RX metadata structure <code class="docutils literal notranslate"><span class="pre">uhd::rx_metadata_t</span></code> is available to describe
information about the streaming process and the sample packet. Most
useful to us will be the <code class="docutils literal notranslate"><span class="pre">error_code</span></code> field of the RX metadata. The
possible flags of the field are:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ERROR_CODE_NONE</span></code>: no error associated with this metadata</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ERROR_CODE_TIMEOUT</span></code>: no packet received, implementation timed-out</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ERROR_CODE_LATE_COMMAND</span></code>: a stream command was issued in the past</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ERROR_CODE_BROKEN_CHAIN</span></code>: expected another stream command</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ERROR_CODE_OVERFLOW</span></code>: an overflow has occurred</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ERROR_CODE_ALIGNMENT</span></code>: ,ulti-channel alignment failed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ERROR_CODE_BAD_PACKET</span></code>: the packet could not be parsed</p></li>
</ul>
</li>
<li><p>One may use the <code class="docutils literal notranslate"><span class="pre">uhd::rx_metadata_t</span> <span class="pre">::strerror()</span></code> method to print out the error.</p></li>
<li><p>The most common error is an overflow which occurs when the host does
not consume data provided by the USRP fast enough. When UHD detects
the overflow, it prints an “O” or “D” to <code class="docutils literal notranslate"><span class="pre">stdout</span></code>, and pushes a
message packet into the RX stream.</p></li>
<li><p><u>Example</u>: <a class="reference internal" href="txrx_RX.html#code-txrx-rx"><span class="std std-ref">txrx_loopback_to_file.cpp (RX)</span></a></p></li>
</ul>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="prelims.html" title="previous page"><span class="section-number">2. </span>Some Programming Prelims</a>
    <a class='right-next' id="next-link" href="multithread.html" title="next page"><span class="section-number">2.2. </span>Elementary Multi-threading</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Tan F. Wong<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>